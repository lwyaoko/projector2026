<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex,nofollow">
<title>Cyber & World Clock - Perfect Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
/* --- 全体レイアウト（既存維持） --- */
html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Share Tech Mono', monospace; background: #000; transition: background 1.5s; }
#background { position: fixed; top:0; left:0; width: 100%; height: 100%; z-index: -1; transition: all 1.5s; }

/* 背景モード定義（既存維持） */
body.mode-standby, body.mode-playlist, body.mode-pixar, body.mode-chill_pop { background: #000; }
body.mode-standby #background, body.mode-playlist #background, body.mode-pixar #background, body.mode-chill_pop #background { 
    background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #050505); 
    background-size: 400% 400%; animation: bgMove 30s ease infinite; opacity: 0.4; 
}
body.mode-schedule { background: #fdf5e6; }
body.mode-schedule #background { background: linear-gradient(135deg, #ffcce0 0%, #ccf2ff 50%, #e0ccff 100%); opacity: 1; animation: bgMove 20s ease infinite; }
@keyframes bgMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

/* --- ニュースモード（追加分：既存を邪魔しない） --- */
#news-screen { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    display: none; grid-template-columns: 60% 40%; grid-template-rows: 1fr 120px;
    background: #001a33; color: white; z-index: 280; 
}
body.mode-news #news-screen { display: grid; }
#news-image-area { background: #000; position: relative; overflow: hidden; border-right: 2px solid #333; }
#news-image { width: 100%; height: 100%; object-fit: cover; transition: opacity 1s; }
#news-headline-area { padding: 40px; background: #002b55; display: flex; flex-direction: column; justify-content: center; }
#news-title { font-size: 3.2vw; font-weight: bold; line-height: 1.5; color: #fff; }
#news-ticker-area { grid-column: span 2; background: #fff; color: #000; overflow: hidden; display: flex; align-items: center; }
#news-ticker { white-space: nowrap; font-size: 2.2vw; font-weight: bold; animation: ticker 40s linear infinite; padding-left: 100%; }
@keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-250%); } }

/* ニュース中の時刻（右上） */
#mini-clock { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 8px; font-size: 2vw; color: #00fff2; border-left: 5px solid #00fff2; z-index: 290; display: none; }
body.mode-news #mini-clock { display: block; }
body.mode-news #clock-container, body.mode-news #weather-section, body.mode-news #calendar-container { display: none; }

/* --- サイバー流れ星（既存維持） --- */
#stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
.cyber-star { position: absolute; width: 150px; height: 1px; background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(0,255,242,0.8) 50%, rgba(255,255,255,0) 100%); filter: drop-shadow(0 0 5px #00fff2); opacity: 0; }
@keyframes cyber-shoot { 0% { transform: translate(0, 0) rotate(var(--angle)); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translate(var(--moveX), var(--moveY)) rotate(var(--angle)); opacity: 0; } }

/* --- 中央時計（既存維持） --- */
#clock-container { position: absolute; top: 38%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 250; width: 100%; pointer-events: none; }
#clock { font-size: 14vw; letter-spacing: 0.05em; line-height: 1; }
#date { font-size: 2.5vw; letter-spacing: 0.3em; margin-bottom: 5px; }
body.mode-standby #clock, body.mode-playlist #clock, body.mode-pixar #clock, body.mode-chill_pop #clock { color: #00fff2; text-shadow: 0 0 10px #00fff2, 0 0 30px #00fff2; }
body.mode-standby #date, body.mode-playlist #date, body.mode-pixar #date, body.mode-chill_pop #date { color: rgba(0, 255, 242, 0.7); }
body.mode-schedule #clock { color: #6a5acd; text-shadow: 2px 2px 0px #fff, 4px 4px 0px #ffcce0; }
body.mode-schedule #date { color: #db7093; font-weight: bold; }

/* --- UI要素（既存維持） --- */
#status { position: absolute; top: 5%; left: 5%; font-size: 1.2em; padding: 10px 15px; z-index: 300; cursor: pointer; text-transform: uppercase; }
body.mode-standby #status, body.mode-playlist #status, body.mode-pixar #status, body.mode-chill_pop #status { color: #ff00ff; border-left: 3px solid #ff00ff; background: rgba(255, 0, 255, 0.05); }
body.mode-news #status { color: #fff; background: #0056b3; }
#calendar-container { position: absolute; top: 5%; right: 5%; text-align: right; z-index: 100; width: 450px; height: 120px; overflow: hidden; }
#calendar-title { font-size: 0.9em; letter-spacing: 2px; border-bottom: 1px solid rgba(0, 255, 242, 0.3); margin-bottom: 10px; padding-bottom: 5px; color: #00fff2; }
#weather-section { position: absolute; bottom: 8%; left: 50%; transform: translateX(-50%); width: 95%; text-align: center; z-index: 20; height: 15vw; color: #ff00ff; }
.weather-panel { position: absolute; display: flex; justify-content: center; align-items: center; width: 80%; left: 10%; opacity: 0; transition: all 0.8s ease; }
.weather-panel.active { opacity: 1; }
#tapNotice { position: absolute; bottom: 2%; width: 100%; text-align: center; color: white; animation: blink 1.5s infinite; z-index: 100; }
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
#player { position: fixed; bottom: 0; right: 0; width: 1px; height: 1px; opacity: 0; }
</style>
</head>

<body class="mode-standby">
<div id="background"></div>
<div id="stars-container"></div>

<div id="news-screen">
    <div id="news-image-area"><img id="news-image" src="" alt=""></div>
    <div id="news-headline-area"><div id="news-title">Loading...</div></div>
    <div id="news-ticker-area"><div id="news-ticker">ニュースを読み込んでいます...</div></div>
    <div id="mini-clock">00:00:00</div>
</div>

<div id="status" onclick="handleStatusClick()">SYSTEM: START</div>
<div id="calendar-container">
    <div id="calendar-title">UPCOMING</div>
    <div id="calendar-list"></div>
</div>

<div id="clock-container">
    <div id="date">0000.00.00 ---</div>
    <div id="clock">00:00:00</div>
</div>

<div id="weather-section">
    <div id="location-tag">TOKYO / SHINJUKU</div>
    <div id="panel-current" class="weather-panel active">
        <div id="main-icon" style="font-size:7vw; margin-right:40px;">--</div>
        <div style="font-size:3.5vw; font-weight:900;"><span id="temp-val">--</span> / <span id="prec-val">--</span></div>
    </div>
    <div id="panel-forecast" class="weather-panel">
        <div id="forecast-container" style="display:flex; width:100%; justify-content:space-around;"></div>
    </div>
</div>

<div id="tapNotice">SYSTEM START: TAP SCREEN</div>
<div id="player"></div>

<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

<script>
const CLIENT_ID = '751679996100-jpv7socqnm0ldlv6b5fp0uavbdq6a24u.apps.googleusercontent.com';
const API_KEY = 'AIzaSyAlT8AxD8pq3iqIV7By4calMIKLzG_vDe8';
const BASE_VIDEO_ID = "LDmImf4WIk4"; 
const LAT = 35.6895; const LON = 139.6917;

let MODE = "standby", activated = false, player, currentNews = [], newsIndex = 0;

function gapiLoaded() { gapi.load('client', async () => { await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'] }); }); }
function gisLoaded() { tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly', callback: '' }); }

function updateClock() {
    const now = new Date();
    const timeStr = now.toTimeString().split(' ')[0];
    document.getElementById("clock").textContent = timeStr;
    document.getElementById("mini-clock").textContent = timeStr;
    document.getElementById("date").textContent = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} ${["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"][now.getDay()]}`;
    if (now.getSeconds() === 0) shootMinuteStars();
}
setInterval(updateClock, 1000);

async function fetchNews() {
    try {
        const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://news.google.com/rss/headlines/section/topic/NATION?hl=ja&gl=JP&ceid=JP:ja`);
        const data = await res.json();
        if (data.items) { currentNews = data.items; rotateNews(); }
    } catch (e) {}
}

function rotateNews() {
    if (currentNews.length === 0 || MODE !== "news") return;
    const item = currentNews[newsIndex];
    document.getElementById("news-title").textContent = item.title.split(' - ')[0];
    const img = item.thumbnail || item.enclosure.link || "https://images.unsplash.com/photo-1504711432869-0fd10786c13b?auto=format&fit=crop&w=800&q=80";
    const imgEl = document.getElementById("news-image");
    imgEl.style.opacity = 0;
    setTimeout(() => { imgEl.src = img; imgEl.style.opacity = 1; }, 500);
    document.getElementById("news-ticker").textContent = currentNews.map(n => n.title.split(' - ')[0]).join('　　/　　');
    newsIndex = (newsIndex + 1) % currentNews.length;
}
setInterval(rotateNews, 15000);

async function updateWeather() {
    try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,precipitation,weather_code&hourly=temperature_2m,weather_code&timezone=Asia%2FTokyo`);
        const data = await res.json();
        document.getElementById("temp-val").textContent = data.current.temperature_2m.toFixed(1) + "°C";
        document.getElementById("prec-val").textContent = data.current.precipitation.toFixed(1) + "mm";
        document.getElementById("main-icon").textContent = (data.current.weather_code <= 3) ? "☀️" : "☁️";
        const container = document.getElementById("forecast-container");
        const hour = new Date().getHours();
        container.innerHTML = [3, 6, 9, 12].map(i => {
            const h = (hour + i) % 24;
            return `<div style="text-align:center;"><div>${h}時</div><div style="font-size:3vw;">${(data.hourly.weather_code[hour+i] <= 3) ? "☀️" : "☁️"}</div><div>${data.hourly.temperature_2m[hour+i].toFixed(0)}°</div></div>`;
        }).join('');
    } catch (e) {}
}
setInterval(updateWeather, 900000); updateWeather();

function toggleMode(direction) {
    const MODES = ["standby", "schedule", "playlist", "pixar", "chill_pop", "news"];
    MODE = MODES[(MODES.indexOf(MODE) + direction + 6) % 6];
    document.body.className = "mode-" + MODE;
    document.getElementById("status").textContent = `MODE: ${MODE.toUpperCase().replace('_',' ')}`;
    if (MODE === "news") fetchNews();
    else if (player) player.loadVideoById(BASE_VIDEO_ID);
}

function handleStatusClick() { if (!activated) startSystem(); else toggleMode(1); }
function startSystem() { 
    activated = true; document.getElementById("tapNotice").style.display = "none";
    if (player) player.loadVideoById(BASE_VIDEO_ID);
}

function onYouTubeIframeAPIReady() { player = new YT.Player('player', { height: '1', width: '1' }); }
function shootMinuteStars() {
    if (MODE === "news") return;
    const container = document.getElementById('stars-container');
    const star = document.createElement('div');
    star.className = 'cyber-star';
    star.style.left = '80%'; star.style.top = '10%';
    star.style.setProperty('--angle', '160deg'); star.style.setProperty('--moveX', '-800px'); star.style.setProperty('--moveY', '800px');
    star.style.animation = 'cyber-shoot 1.8s forwards';
    container.appendChild(star);
    setTimeout(() => star.remove(), 2000);
}

const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; document.body.appendChild(tag);
setInterval(() => {
    const p1 = document.getElementById("panel-current"); const p2 = document.getElementById("panel-forecast");
    if(p1.classList.contains("active")) { p1.classList.remove("active"); p2.classList.add("active"); } 
    else { p2.classList.remove("active"); p1.classList.add("active"); }
}, 10000);
document.body.addEventListener('click', () => { if(!activated) startSystem(); });
</script>
</body>
</html>
