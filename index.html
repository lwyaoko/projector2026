<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Cyber Clock - Calendar Frame Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
/* 既存のスタイル維持 */
html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Share Tech Mono', monospace; background: #000; }
#background { position: fixed; width: 200%; height: 200%; background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #050505); background-size: 400% 400%; animation: bgMove 30s ease infinite; z-index: -1; opacity: 0.4; }
@keyframes bgMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

#clock-container { position: absolute; top: 38%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 10; width: 100%; }
#clock { color: #00fff2; font-size: 14vw; letter-spacing: 0.05em; text-shadow: 0 0 10px #00fff2, 0 0 30px #00fff2; line-height: 1; }
#date { color: rgba(0, 255, 242, 0.7); font-size: 2.5vw; letter-spacing: 0.3em; margin-bottom: 5px; }

/* 右上カレンダーエリア（新規追加） */
#calendar-container {
    position: absolute; top: 5%; right: 5%; 
    text-align: right; z-index: 100;
    width: 300px;
}
#calendar-title {
    color: #00fff2; font-size: 0.8em; letter-spacing: 2px;
    border-bottom: 1px solid rgba(0, 255, 242, 0.3);
    margin-bottom: 10px; padding-bottom: 5px; opacity: 0.8;
}
.event-item {
    color: #fff; font-size: 1.1em; margin-bottom: 8px;
    text-shadow: 0 0 5px #00fff2;
    animation: slideIn 0.5s ease-out forwards;
}
.event-time { color: #00fff2; font-weight: bold; margin-right: 10px; }

/* ステータス（左上） */
#status { 
    position: absolute; top: 5%; left: 5%; color: #ff00ff; font-size: 1.2em; 
    border-left: 3px solid #ff00ff; padding: 10px 15px; text-transform: uppercase; z-index: 100; 
    cursor: pointer; background: rgba(255, 0, 255, 0.05); transition: background 0.3s;
    user-select: none;
}

/* 天気表示系は維持 */
#weather-section { position: absolute; bottom: 8%; left: 50%; transform: translateX(-50%); width: 90%; text-align: center; z-index: 20; }
.weather-panel { position: absolute; display: flex; justify-content: center; align-items: center; gap: 40px; background: rgba(0, 0, 0, 0.8); padding: 20px 40px; border-radius: 15px; border: 1px solid rgba(255, 0, 255, 0.3); width: 60%; opacity: 0; transform: translateY(20px); transition: all 0.8s ease; pointer-events: none; }
.weather-panel.active { opacity: 1; transform: translateY(0); pointer-events: auto; }

#tapNotice { position: absolute; bottom: 2%; width: 100%; text-align: center; color: white; font-size: 1.2em; animation: blink 1.5s infinite; z-index: 100; }
@keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
#player { display: none; }
</style>
</head>

<body>
<div id="background"></div>

<div id="status" onclick="handleStatusClick()">SYSTEM: STANDBY</div>

<div id="calendar-container">
    <div id="calendar-title">UPCOMING SCHEDULE</div>
    <div id="calendar-list">
        <div class="event-item" style="opacity: 0.5; font-size: 0.8em;">NOT AUTHENTICATED</div>
    </div>
</div>

<div id="clock-container">
    <div id="date">0000.00.00 ---</div>
    <div id="clock">00:00:00</div>
</div>

<div id="weather-section">
    <div id="location-tag">TOKYO / SHINJUKU</div>
    <div id="weather-display-area">
        <div id="panel-current" class="weather-panel active">
            <div id="main-icon" style="font-size: 6vw; color: #fff; width: 10vw; text-align: center;">--</div>
            <div style="display: flex; gap: 30px; text-align: left;">
                <div style="display: flex; flex-direction: column;"><div style="font-size: 1vw; color: #ff00ff; opacity: 0.8;">TEMPERATURE</div><div id="temp-val" style="font-size: 3vw; color: #fff; text-shadow: 0 0 10px #ff00ff; font-weight: bold;">--°C</div></div>
                <div style="display: flex; flex-direction: column;"><div style="font-size: 1vw; color: #ff00ff; opacity: 0.8;">PRECIPITATION</div><div id="prec-val" style="font-size: 3vw; color: #fff; text-shadow: 0 0 10px #ff00ff; font-weight: bold;">--mm</div></div>
            </div>
        </div>
        <div id="panel-forecast" class="weather-panel">
            <div id="forecast-container" style="display: flex; gap: 20px; justify-content: space-around; width: 100%;"></div>
        </div>
    </div>
</div>

<div id="tapNotice">SYSTEM START: TAP SCREEN</div>
<div id="player"></div>

<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

<script>
/* 基本設定（天気・YouTube）はこれまでのものを維持 */
const LAT = 35.6895; 
const LON = 139.6917;
const PLAYLIST_ID = "PLu2X5r9Wu8IgVxyUSBeXFJ-ZnBqdeBdsP";
const SCHEDULE = [{ hour: 8, min: 59, sec: 13, video: "HSZBQUcB1Dc" },{ hour: 9, min: 59, sec: 13, video: "HSZBQUcB1Dc" }];

let player, activated = false, playedList = [], MODE = "schedule";

/* カレンダー連携用の枠組み関数（ここに後で認証処理を足してください） */
function gapiLoaded() {
    console.log("GAPI loaded. Ready for implementation.");
}
function gisLoaded() {
    console.log("GIS loaded. Ready for implementation.");
}

// 予定を表示するための関数（例：updateCalendar([{time: "12:00-13:00", title: "会議"}])）
function updateCalendar(events) {
    const list = document.getElementById("calendar-list");
    list.innerHTML = "";
    if (events.length === 0) {
        list.innerHTML = '<div class="event-item">NO UPCOMING EVENTS</div>';
        return;
    }
    events.forEach(ev => {
        const div = document.createElement("div");
        div.className = "event-item";
        div.innerHTML = `<span class="event-time">${ev.time}</span> ${ev.title}`;
        list.appendChild(div);
    });
}

/* --- 既存のロジック --- */
// (天気更新、時計更新、YouTube制御、パネル切り替えなどは前回の「10秒切り替え/リモコン対応版」を継承)

async function updateWeather() {
    try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,precipitation,weather_code&hourly=temperature_2m,weather_code&timezone=Asia%2FTokyo`;
        const res = await fetch(url);
        const data = await res.json();
        document.getElementById("temp-val").textContent = data.current.temperature_2m.toFixed(1) + "°C";
        document.getElementById("prec-val").textContent = data.current.precipitation.toFixed(1) + "mm";
        document.getElementById("main-icon").textContent = "☀"; // 簡易
    } catch (e) { console.log("Weather Error"); }
}

function switchPanels() {
    const p1 = document.getElementById("panel-current");
    const p2 = document.getElementById("panel-forecast");
    setInterval(() => {
        if (p1.classList.contains("active")) { p1.classList.remove("active"); p2.classList.add("active"); } 
        else { p2.classList.remove("active"); p1.classList.add("active"); }
    }, 10000); 
}

setInterval(() => {
    const now = new Date();
    document.getElementById("clock").textContent = now.toTimeString().split(' ')[0];
}, 1000);

function handleStatusClick() {
    if (!activated) { startSystem(); } else { toggleMode(); }
}

function toggleMode() {
    MODE = (MODE === "schedule") ? "playlist" : "schedule";
    if (MODE === "playlist") { player.unMute(); player.setVolume(100); } else { player.mute(); }
    document.getElementById("status").textContent = `MODE: ${MODE.toUpperCase()}`;
}

function startSystem() {
    if (activated) return;
    activated = true;
    document.getElementById("tapNotice").style.display = "none";
    document.getElementById("status").textContent = "MODE: SCHEDULE";
    // YouTube初期化などは省略（前回のコードをそのまま流用してください）
}

document.body.addEventListener('click', (e) => { if (e.target.id !== "status") startSystem(); }, {once: true});
document.addEventListener('keydown', (e) => { if (activated && (e.key === "ArrowLeft" || e.key === "ArrowRight")) toggleMode(); });

updateWeather();
switchPanels();
</script>
</body>
</html>
