<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Nixie Cyber Clock - Shinjuku</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root {
    --nixie-color: #00fff2;
    --nixie-glow: #00fff2;
}

html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    overflow: hidden;
    font-family: 'Share Tech Mono', monospace;
    background: #050505;
}

/* ニキシー管のコンテナ */
#clock-display {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 60vh;
    gap: 15px;
}

/* ガラス管のデザイン */
.nixie-tube {
    width: 10vw;
    height: 18vw;
    background: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
    border-radius: 50px 50px 10px 10px;
    border: 1px solid rgba(255,255,255,0.2);
    position: relative;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5), 0 0 15px rgba(0,255,242,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
}

.nixie-tube::after {
    content: "";
    position: absolute;
    top: 5%; left: 15%; width: 20%; height: 80%;
    background: linear-gradient(to right, rgba(255,255,255,0.2), transparent);
    border-radius: 50px;
}

.digit {
    font-size: 10vw;
    color: var(--nixie-color);
    text-shadow: 0 0 10px var(--nixie-glow), 0 0 20px var(--nixie-glow);
    z-index: 2;
}

/* 天気セクション（Yahoo天気風レイアウト） */
#weather-section {
    position: absolute; bottom: 5%; left: 50%;
    transform: translateX(-50%);
    width: 95%; max-width: 900px;
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid #333;
    border-radius: 8px;
    overflow: hidden;
}

#weather-table {
    width: 100%; border-collapse: collapse; text-align: center;
    color: #ccc; font-size: 1.2vw;
}

#weather-table th, #weather-table td {
    padding: 10px 5px; border: 1px solid #333;
}

.row-label { background: #1a1a1a; width: 15%; color: #888; }
.w-icon { font-size: 2vw; margin: 5px 0; }
.w-temp { color: #fff; font-weight: bold; }

#location-info {
    position: absolute; top: 5%; right: 5%;
    color: #ff00ff; border-left: 3px solid #ff00ff; padding-left: 10px;
}

#tapNotice {
    position: absolute; bottom: 2%; width: 100%; text-align: center;
    color: #444; font-size: 1em; animation: blink 2s infinite;
}
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }

#player { display: none; }
</style>
</head>

<body>
<div id="location-info">SYSTEM ONLINE: TOKYO / SHINJUKU</div>

<div id="clock-display">
    <div class="nixie-tube"><div class="digit" id="h1">0</div></div>
    <div class="nixie-tube"><div class="digit" id="h2">0</div></div>
    <div style="font-size:5vw; color:#333;">:</div>
    <div class="nixie-tube"><div class="digit" id="m1">0</div></div>
    <div class="nixie-tube"><div class="digit" id="m2">0</div></div>
    <div style="font-size:5vw; color:#333;">:</div>
    <div class="nixie-tube"><div class="digit" id="s1">0</div></div>
    <div class="nixie-tube"><div class="digit" id="s2">0</div></div>
</div>

<div id="weather-section">
    <table id="weather-table">
        <tr id="row-time"><td class="row-label">時刻</td></tr>
        <tr id="row-icon"><td class="row-label">天気</td></tr>
        <tr id="row-temp"><td class="row-label">気温(℃)</td></tr>
    </table>
</div>

<div id="tapNotice">TAP TO ACTIVATE AUDIO</div>
<div id="player"></div>

<script>
const AREA_CODE = "130000"; 
let activated = false;
const PLAYLIST_ID = "PLu2X5r9Wu8IgVxyUSBeXFJ-ZnBqdeBdsP";

// アイコン変換
function getIcon(code) {
    if (code.startsWith("1")) return "☀";
    if (code.startsWith("2")) return "☁";
    if (code.startsWith("3")) return "☔";
    return "✨";
}

// Yahoo天気風テーブル更新
async function updateWeather() {
    try {
        const res = await fetch(`https://www.jma.go.jp/bosai/forecast/data/forecast/${AREA_CODE}.json`);
        const data = await res.json();
        
        const timeSeries = data[0].timeSeries;
        const weatherCodes = timeSeries[0].areas[0].weatherCodes;
        const times = timeSeries[0].timeDefines;
        // 気温データ（今日）
        const temps = timeSeries[2].areas[0].temps;

        const rowTime = document.getElementById("row-time");
        const rowIcon = document.getElementById("row-icon");
        const rowTemp = document.getElementById("row-temp");

        // 既存データをクリア（ラベル以外）
        while(rowTime.cells.length > 1) rowTime.deleteCell(1);
        while(rowIcon.cells.length > 1) rowIcon.deleteCell(1);
        while(rowTemp.cells.length > 1) rowTemp.deleteCell(1);

        for(let i=0; i<Math.min(8, weatherCodes.length); i++) {
            const h = new Date(times[i]).getHours() + "時";
            rowTime.insertCell(-1).textContent = h;
            rowIcon.insertCell(-1).innerHTML = `<div class="w-icon">${getIcon(weatherCodes[i])}</div>`;
            rowTemp.insertCell(-1).innerHTML = `<div class="w-temp">${temps[i] || "--"}</div>`;
        }
    } catch (e) { console.log(e); }
}

// ニキシー管時計の更新
function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');

    document.getElementById("h1").textContent = h[0];
    document.getElementById("h2").textContent = h[1];
    document.getElementById("m1").textContent = m[0];
    document.getElementById("m2").textContent = m[1];
    document.getElementById("s1").textContent = s[0];
    document.getElementById("s2").textContent = s[1];
}

setInterval(updateClock, 1000);
updateWeather();
setInterval(updateWeather, 3600000);

// YouTube API
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

let player;
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '0', width: '0',
        playerVars: { 'autoplay': 0, 'controls': 0, 'enablejsapi': 1 }
    });
}

document.body.addEventListener('click', () => {
    if (!activated && player) {
        activated = true;
        document.getElementById("tapNotice").style.display = "none";
        player.unMute();
        player.setVolume(100);
        player.loadPlaylist({list: PLAYLIST_ID});
        player.playVideo();
        setTimeout(() => player.pauseVideo(), 1500);
    }
}, {once: true});
</script>
</body>
</html>
